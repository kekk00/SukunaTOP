import { readDB } from '../handler.js';

export const command = ['topgruppi'];

export async function run(sock, message, args) {
    const gpdb = readDB('gpdb.json');

    // Ordina i gruppi per numero di messaggi
    const sortedGroups = Object.entries(gpdb)
        .sort((a, b) => b[1].messages - a[1].messages)
        .slice(0, 10);

    let text = 'ğŸ“© Top Gruppi\n\n';
    const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];

    sortedGroups.forEach(([name, data], i) => {
        const medal = medals[i] || `ğŸ… ${i + 1}`;
        text += `${medal}${i + 1}. ${name}\nğŸ’Œ ${data.messages} | ğŸ‘¥ ${data.members}\n\n`;
    });

    // Creiamo bottoni per altri comandi
    const buttons = [
        { buttonId: '!topusers', buttonText: { displayText: 'ğŸ‘¤ Top Users' }, type: 1 },
        { buttonId: '!profilo', buttonText: { displayText: 'ğŸŒŸ Info Utente' }, type: 1 }
    ];

    const buttonMessage = {
        text,
        footer: 'ğ’ğ”ğŠğ”ğğ€â¶â¶â¶-ğğ¨ğ­',
        buttons,
        headerType: 1
    };

    // Invia il messaggio citando quello originale
    await sock.sendMessage(message.key.remoteJid, buttonMessage, { quoted: message });
}